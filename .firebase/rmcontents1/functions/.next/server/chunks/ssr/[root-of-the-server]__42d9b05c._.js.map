{"version":3,"sources":["turbopack:///[project]/node_modules/uuid/dist-node/native.js","turbopack:///[project]/node_modules/uuid/dist-node/rng.js","turbopack:///[project]/node_modules/uuid/dist-node/regex.js","turbopack:///[project]/node_modules/uuid/dist-node/validate.js","turbopack:///[project]/node_modules/uuid/dist-node/stringify.js","turbopack:///[project]/node_modules/uuid/dist-node/v4.js","turbopack:///[project]/app/request/page.tsx"],"sourcesContent":["import { randomUUID } from 'node:crypto';\nexport default { randomUUID };\n","import { randomFillSync } from 'node:crypto';\nconst rnds8Pool = new Uint8Array(256);\nlet poolPtr = rnds8Pool.length;\nexport default function rng() {\n    if (poolPtr > rnds8Pool.length - 16) {\n        randomFillSync(rnds8Pool);\n        poolPtr = 0;\n    }\n    return rnds8Pool.slice(poolPtr, (poolPtr += 16));\n}\n","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;\n","import REGEX from './regex.js';\nfunction validate(uuid) {\n    return typeof uuid === 'string' && REGEX.test(uuid);\n}\nexport default validate;\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction _v4(options, buf, offset) {\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    return _v4(options, buf, offset);\n}\nexport default v4;\n","// app/request/page.tsx\r\n\r\n\"use client\";\r\n\r\nimport { useState, FormEvent, ChangeEvent, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { db, storage } from \"@/lib/firebase\";\r\nimport { collection, addDoc, serverTimestamp, doc, getDoc } from \"firebase/firestore\";\r\nimport { ref, uploadBytes, getDownloadURL } from \"firebase/storage\";\r\nimport { v4 as uuidv4 } from \"uuid\"; // 파일명 중복 방지를 위해 uuid 사용\r\n\r\nexport default function RequestPage() {\r\n  const { user, loading } = useAuth();\r\n  const router = useRouter();\r\n\r\n  // 폼 상태\r\n  const [title, setTitle] = useState(\"\");\r\n  const [details, setDetails] = useState(\"\");\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  \r\n  // --- [수정된 부분 START] ---\r\n  // 2. 로그인 안 한 사용자 보호 로직을 useEffect로 이동\r\n  useEffect(() => {\r\n    if (loading) {\r\n      return; // AuthContext가 로딩 중일 때는 대기\r\n    }\r\n    if (!user) {\r\n      // 로딩이 끝났는데 유저 정보가 없으면 로그인 페이지로 리디렉션\r\n      alert(\"로그인이 필요한 서비스입니다.\");\r\n      router.push(\"/login\");\r\n    }\r\n  }, [user, loading, router]); // user나 loading 상태가 변경될 때마다 이 효과를 재실행\r\n  // --- [수정된 부분 END] ---\r\n  \r\n  // 파일 선택 핸들러\r\n  const handleFileChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files && e.target.files[0]) {\r\n      setFile(e.target.files[0]);\r\n    }\r\n  };\r\n\r\n  // 폼 제출 핸들러\r\n  const handleSubmit = async (e: FormEvent) => {\r\n    e.preventDefault();\r\n    if (!user) {\r\n      setError(\"로그인이 필요합니다.\");\r\n      return;\r\n    }\r\n    if (!title || !details) {\r\n      setError(\"요청 제목과 상세 내용은 필수입니다.\");\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    setError(\"\");\r\n\r\n    try {\r\n      let fileUrl = \"\";\r\n      let storagePath = \"\";\r\n\r\n      // 1. (선택) 파일이 있으면 Storage에 업로드\r\n      if (file) {\r\n        // 파일명 중복을 피하기 위해 uuid 사용\r\n        const uniqueFileName = `${uuidv4()}-${file.name}`;\r\n        storagePath = `uploads/requests/${user.uid}/${uniqueFileName}`;\r\n        const fileRef = ref(storage, storagePath);\r\n        \r\n        await uploadBytes(fileRef, file);\r\n        fileUrl = await getDownloadURL(fileRef); // 다운로드 URL 확보\r\n      }\r\n\r\n      // 2. 강사 프로필 정보 (이름, 학원명) 가져오기\r\n      const userDoc = await getDoc(doc(db, \"users\", user.uid));\r\n      const userData = userDoc.data();\r\n\r\n      // 3. Firestore 'requests' 컬렉션에 요청서 저장\r\n      await addDoc(collection(db, \"requests\"), {\r\n        instructorId: user.uid,\r\n        instructorName: userData?.name || \"이름없음\", // 프로필 정보\r\n        academy: userData?.academy || \"학원없음\", // 프로필 정보\r\n        title: title,\r\n        details: details,\r\n        status: \"requested\", // 초기 상태: '요청됨'\r\n        requestedAt: serverTimestamp(), // 서버 시간 기준\r\n        referenceFileUrl: fileUrl, // (선택) 참고 파일 URL\r\n        referenceStoragePath: storagePath, // (선택) 참고 파일 경로\r\n        // completedFileUrl 등은 나중에 관리자가 업데이트\r\n      });\r\n\r\n      // 4. 완료 후 대시보드로 이동\r\n      alert(\"작업 요청이 성공적으로 제출되었습니다.\");\r\n      router.push(\"/dashboard\");\r\n\r\n    } catch (err) {\r\n      console.error(\"요청 제출 중 에러:\", err);\r\n      setError(\"제출 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\");\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n  \r\n  // 로그인 안 한 사용자 보호\r\n  if (loading) {\r\n    return <div className=\"flex min-h-screen items-center justify-center\">로딩 중...</div>\r\n  }\r\n  if (!user) {\r\n    // (개선) 실제로는 AuthContext에서 리디렉션하지만, 2차 방어\r\n    router.push(\"/login\");\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen flex-col\">\r\n      <main className=\"flex-grow bg-gray-50 py-16\">\r\n        <div className=\"container mx-auto max-w-2xl rounded-lg bg-white p-8 shadow-md\">\r\n          <h1 className=\"mb-8 text-center text-3xl font-bold text-gray-900\">\r\n            새 작업 요청하기\r\n          </h1>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <div>\r\n              <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700\">\r\n                요청 제목 (필수)\r\n              </label>\r\n              <input\r\n                id=\"title\"\r\n                type=\"text\"\r\n                value={title}\r\n                onChange={(e) => setTitle(e.target.value)}\r\n                required\r\n                className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\r\n                placeholder=\"예: OO고 2학년 1학기 중간고사 대비\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label htmlFor=\"details\" className=\"block text-sm font-medium text-gray-700\">\r\n                상세 요청 내용 (필수)\r\n              </label>\r\n              <textarea\r\n                id=\"details\"\r\n                rows={6}\r\n                value={details}\r\n                onChange={(e) => setDetails(e.target.value)}\r\n                required\r\n                className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\r\n                placeholder=\"필요한 문항 수, 난이도, 특정 유형, 마감일 등 상세 내용을 적어주세요.\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label htmlFor=\"file\" className=\"block text-sm font-medium text-gray-700\">\r\n                참고 파일 (선택)\r\n              </label>\r\n              <p className=\"text-xs text-gray-500 mb-2\">\r\n                학교 기출 문제, 참고 자료 등 PDF 파일을 업로드할 수 있습니다.\r\n              </p>\r\n              <input\r\n                id=\"file\"\r\n                type=\"file\"\r\n                accept=\".pdf\" // PDF 파일만 허용 (필요시 수정)\r\n                onChange={handleFileChange}\r\n                className=\"block w-full text-sm text-gray-500\r\n                  file:mr-4 file:rounded-md file:border-0\r\n                  file:bg-blue-50 file:px-4 file:py-2\r\n                  file:text-sm file:font-medium file:text-blue-700\r\n                  hover:file:bg-blue-100\"\r\n              />\r\n            </div>\r\n\r\n            {error && (\r\n              <p className=\"text-center text-sm text-red-600\">{error}</p>\r\n            )}\r\n\r\n            <div>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isSubmitting}\r\n                className=\"w-full rounded-md border border-transparent bg-blue-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50\"\r\n              >\r\n                {isSubmitting ? \"제출 중...\" : \"작업 요청하기\"}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","ignoreList":[0,1,2,3,4,5]}