{"version":3,"sources":["turbopack:///[project]/app/dashboard/page.tsx"],"sourcesContent":["// app/dashboard/page.tsx\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport {\r\n  collection,\r\n  query,\r\n  where,\r\n  getDocs,\r\n  Timestamp,\r\n  orderBy,\r\n} from \"firebase/firestore\";\r\n\r\n// 강사 대시보드에서 사용할 요청 데이터 타입\r\ninterface MyRequestData {\r\n  id: string;\r\n  title: string;\r\n  status: \"requested\" | \"in_progress\" | \"completed\";\r\n  requestedAt: Timestamp;\r\n  completedAt?: Timestamp; // 완료된 작업에만 존재\r\n  completedFileUrl?: string; // 완료된 작업에만 존재\r\n}\r\n\r\nexport default function DashboardPage() {\r\n  const { user, loading } = useAuth();\r\n  const router = useRouter();\r\n  \r\n  const [requests, setRequests] = useState<MyRequestData[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // 1. 로그인한 사용자의 요청 목록만 불러오기\r\n  useEffect(() => {\r\n    // AuthContext가 유저 정보를 로드할 때까지 대기\r\n    if (loading) return;\r\n    \r\n    // 로그아웃 상태면 로그인 페이지로\r\n    if (!user) {\r\n      router.push(\"/login\");\r\n      return;\r\n    }\r\n\r\n    const fetchMyRequests = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        // 'requests' 컬렉션에서 'instructorId'가 현재 유저의 uid와 같은 것만 쿼리\r\n        const q = query(\r\n          collection(db, \"requests\"),\r\n          where(\"instructorId\", \"==\", user.uid),\r\n          orderBy(\"requestedAt\", \"desc\") // 최신순으로 정렬\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const requestList = querySnapshot.docs.map((doc) => ({\r\n          id: doc.id,\r\n          ...doc.data(),\r\n        } as MyRequestData));\r\n        \r\n        setRequests(requestList);\r\n      } catch (error) {\r\n        console.error(\"내 요청 목록을 불러오는 중 에러:\", error);\r\n      }\r\n      setIsLoading(false);\r\n    };\r\n\r\n    fetchMyRequests();\r\n  }, [user, loading, router]);\r\n\r\n  // 로딩 화면\r\n  if (loading || isLoading) {\r\n    return (\r\n      <div className=\"flex min-h-screen items-center justify-center\">\r\n        요청 목록을 불러오는 중...\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // 로그인 안 된 상태 (위 useEffect에서 리디렉션되지만, 방어 코드)\r\n  if (!user) {\r\n    return null; \r\n  }\r\n\r\n  // --- 강사 대시보드 UI ---\r\n  return (\r\n    <div className=\"flex min-h-screen flex-col\">\r\n      <main className=\"flex-grow bg-gray-50 py-12\">\r\n        <div className=\"container mx-auto max-w-5xl px-6\">\r\n          \r\n          <div className=\"flex flex-col items-start justify-between gap-4 md:flex-row md:items-center\">\r\n            <h1 className=\"text-3xl font-bold text-gray-900\">\r\n              내 작업 목록\r\n            </h1>\r\n            <Link \r\n              href=\"/request\"\r\n              className=\"rounded-md bg-blue-600 px-5 py-2.5 text-sm font-medium text-white shadow-sm transition-colors hover:bg-blue-700\"\r\n            >\r\n              + 새 작업 요청하기\r\n            </Link>\r\n          </div>\r\n          \r\n          <div className=\"mt-8 overflow-x-auto rounded-lg bg-white shadow\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">상태</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">요청 제목</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">요청일</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">완료/다운로드</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-200\">\r\n                {requests.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan={4} className=\"px-6 py-12 text-center text-gray-500\">\r\n                      아직 요청한 작업이 없습니다.\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  requests.map((req) => (\r\n                    <tr key={req.id} className=\"hover:bg-gray-50\">\r\n                      {/* 상태 */}\r\n                      <td className=\"px-6 py-4\">\r\n                        {req.status === 'requested' && <span className=\"rounded-full bg-red-100 px-2 py-1 text-xs font-semibold text-red-700\">요청됨</span>}\r\n                        {req.status === 'in_progress' && <span className=\"rounded-full bg-yellow-100 px-2 py-1 text-xs font-semibold text-yellow-700\">작업중</span>}\r\n                        {req.status === 'completed' && <span className=\"rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-700\">완료됨</span>}\r\n                      </td>\r\n                      {/* 제목 */}\r\n                      <td className=\"px-6 py-4 font-medium text-gray-900\">{req.title}</td>\r\n                      {/* 요청일 */}\r\n                      <td className=\"px-6 py-4 text-gray-500\">{req.requestedAt.toDate().toLocaleDateString('ko-KR')}</td>\r\n                      {/* 완료/다운로드 */}\r\n                      <td className=\"px-6 py-4\">\r\n                        {req.status === 'completed' && req.completedFileUrl ? (\r\n                          <a\r\n                            href={req.completedFileUrl}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"rounded-md bg-blue-100 px-3 py-2 text-sm font-medium text-blue-700 hover:bg-blue-200\"\r\n                          >\r\n                            다운로드\r\n                          </a>\r\n                        ) : (\r\n                          <span className=\"text-sm text-gray-400\">\r\n                            {req.status === 'in_progress' ? '작업 진행 중' : '대기 중'}\r\n                          </span>\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}