{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///c:/rmcontents1/app/admin/page.tsx"],"sourcesContent":["// app/admin/page.tsx\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport {\r\n  collection,\r\n  query,\r\n  where,\r\n  getDocs,\r\n  Timestamp,\r\n  orderBy,\r\n} from \"firebase/firestore\";\r\n\r\n// Firestore에서 가져올 요청 데이터의 타입 정의\r\ninterface RequestData {\r\n  id: string;\r\n  title: string;\r\n  instructorName: string;\r\n  academy: string;\r\n  status: \"requested\" | \"in_progress\" | \"completed\";\r\n  requestedAt: Timestamp;\r\n}\r\n\r\nexport default function AdminDashboard() {\r\n  // --- [수정된 부분 1] ---\r\n  // isAdmin을 user 객체 안에서 가져오도록 수정\r\n  const { user, loading } = useAuth();\r\n  const isAdmin = user?.isAdmin; // user가 있을 때만 isAdmin 값을 가져옴\r\n  // --- [수정 끝] ---\r\n  const router = useRouter();\r\n  \r\n  const [requests, setRequests] = useState<RequestData[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // 1. 로딩이 끝났는지 확인\r\n    if (loading) return;\r\n\r\n    // 2. 관리자가 아니면 강사 대시보드로 리디렉션\r\n    if (!user || !isAdmin) {\r\n      alert(\"접근 권한이 없습니다.\");\r\n      router.push(\"/dashboard\");\r\n      return;\r\n    }\r\n\r\n    // 3. 관리자일 경우, 요청 목록 불러오기\r\n    const fetchRequests = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        // 'completed' 상태가 아닌 모든 요청을 'requestedAt' 기준으로 내림차순 정렬\r\n        const q = query(\r\n          collection(db, \"requests\"),\r\n          where(\"status\", \"!=\", \"completed\"),\r\n          orderBy(\"status\"), // 'in_progress'가 'requested'보다 위로 (알파벳순)\r\n          orderBy(\"requestedAt\", \"desc\")\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const requestList = querySnapshot.docs.map((doc) => ({\r\n          id: doc.id,\r\n          ...doc.data(),\r\n        } as RequestData));\r\n        \r\n        setRequests(requestList);\r\n      } catch (error) {\r\n        console.error(\"요청 목록을 불러오는 중 에러:\", error);\r\n      }\r\n      setIsLoading(false);\r\n    };\r\n\r\n    fetchRequests();\r\n  }, [user, loading, isAdmin, router]);\r\n\r\n  // 로딩 중 또는 권한 확인 중일 때\r\n  if (loading || isLoading || !isAdmin) {\r\n    return (\r\n      <div className=\"flex min-h-screen items-center justify-center\">\r\n        관리자 정보를 확인 중입니다...\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // --- 관리자 전용 UI ---\r\n  return (\r\n    <div className=\"flex min-h-screen flex-col\">\r\n      <main className=\"flex-grow bg-gray-50 py-12\">\r\n        <div className=\"container mx-auto max-w-5xl px-6\">\r\n          <h1 className=\"mb-8 text-3xl font-bold text-gray-900\">\r\n            관리자 대시보드 (접수된 요청)\r\n          </h1>\r\n          \r\n          <div className=\"overflow-x-auto rounded-lg bg-white shadow\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">상태</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">요청 제목</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">요청 강사 (학원)</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">요청일</th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium uppercase text-gray-500\">관리</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-200\">\r\n                {requests.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan={5} className=\"px-6 py-12 text-center text-gray-500\">\r\n                      새로운 요청이 없습니다.\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  requests.map((req) => (\r\n                    <tr key={req.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4\">\r\n                        {req.status === 'requested' && <span className=\"rounded-full bg-red-100 px-2 py-1 text-xs font-semibold text-red-700\">요청됨</span>}\r\n                        {req.status === 'in_progress' && <span className=\"rounded-full bg-yellow-100 px-2 py-1 text-xs font-semibold text-yellow-700\">작업중</span>}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 font-medium text-gray-900\">{req.title}</td>\r\n                      <td className=\"px-6 py-4 text-gray-700\">{req.instructorName} ({req.academy})</td>\r\n                      <td className=\"px-6 py-4 text-gray-500\">{req.requestedAt.toDate().toLocaleDateString('ko-KR')}</td>\r\n                      <td className=\"px-6 py-4\">\r\n                        <Link \r\n                          href={`/admin/request/${req.id}`}\r\n                          className=\"font-medium text-blue-600 hover:text-blue-800\"\r\n                        >\r\n                          처리하기\r\n                        </Link>\r\n                      </td>\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"AAAA,qBAAqB;;;;;;AAIrB;AACA;AACA;AACA;AACA;AACA;AAAA;;;AAPA;;;;;;;AA0Be,SAAS;;IACtB,qBAAqB;IACrB,gCAAgC;IAChC,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,IAAA,qIAAO;IACjC,MAAM,UAAU,MAAM,SAAS,6BAA6B;IAC5D,iBAAiB;IACjB,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAgB,EAAE;IAC1D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,IAAA,0KAAS;oCAAC;YACR,iBAAiB;YACjB,IAAI,SAAS;YAEb,4BAA4B;YAC5B,IAAI,CAAC,QAAQ,CAAC,SAAS;gBACrB,MAAM;gBACN,OAAO,IAAI,CAAC;gBACZ;YACF;YAEA,yBAAyB;YACzB,MAAM;0DAAgB;oBACpB,aAAa;oBACb,IAAI;wBACF,uDAAuD;wBACvD,MAAM,IAAI,IAAA,2KAAK,EACb,IAAA,gLAAU,EAAC,wHAAE,EAAE,aACf,IAAA,2KAAK,EAAC,UAAU,MAAM,cACtB,IAAA,6KAAO,EAAC,WACR,IAAA,6KAAO,EAAC,eAAe;wBAGzB,MAAM,gBAAgB,MAAM,IAAA,6KAAO,EAAC;wBACpC,MAAM,cAAc,cAAc,IAAI,CAAC,GAAG;kFAAC,CAAC,MAAQ,CAAC;oCACnD,IAAI,IAAI,EAAE;oCACV,GAAG,IAAI,IAAI,EAAE;gCACf,CAAgB;;wBAEhB,YAAY;oBACd,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,qBAAqB;oBACrC;oBACA,aAAa;gBACf;;YAEA;QACF;mCAAG;QAAC;QAAM;QAAS;QAAS;KAAO;IAEnC,qBAAqB;IACrB,IAAI,WAAW,aAAa,CAAC,SAAS;QACpC,qBACE,6LAAC;YAAI,WAAU;sBAAgD;;;;;;IAInE;IAEA,oBAAoB;IACpB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAK,WAAU;sBACd,cAAA,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAwC;;;;;;kCAItD,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAM,WAAU;;8CACf,6LAAC;oCAAM,WAAU;8CACf,cAAA,6LAAC;;0DACC,6LAAC;gDAAG,WAAU;0DAAkE;;;;;;0DAChF,6LAAC;gDAAG,WAAU;0DAAkE;;;;;;0DAChF,6LAAC;gDAAG,WAAU;0DAAkE;;;;;;0DAChF,6LAAC;gDAAG,WAAU;0DAAkE;;;;;;0DAChF,6LAAC;gDAAG,WAAU;0DAAkE;;;;;;;;;;;;;;;;;8CAGpF,6LAAC;oCAAM,WAAU;8CACd,SAAS,MAAM,KAAK,kBACnB,6LAAC;kDACC,cAAA,6LAAC;4CAAG,SAAS;4CAAG,WAAU;sDAAuC;;;;;;;;;;+CAKnE,SAAS,GAAG,CAAC,CAAC,oBACZ,6LAAC;4CAAgB,WAAU;;8DACzB,6LAAC;oDAAG,WAAU;;wDACX,IAAI,MAAM,KAAK,6BAAe,6LAAC;4DAAK,WAAU;sEAAuE;;;;;;wDACrH,IAAI,MAAM,KAAK,+BAAiB,6LAAC;4DAAK,WAAU;sEAA6E;;;;;;;;;;;;8DAEhI,6LAAC;oDAAG,WAAU;8DAAuC,IAAI,KAAK;;;;;;8DAC9D,6LAAC;oDAAG,WAAU;;wDAA2B,IAAI,cAAc;wDAAC;wDAAG,IAAI,OAAO;wDAAC;;;;;;;8DAC3E,6LAAC;oDAAG,WAAU;8DAA2B,IAAI,WAAW,CAAC,MAAM,GAAG,kBAAkB,CAAC;;;;;;8DACrF,6LAAC;oDAAG,WAAU;8DACZ,cAAA,6LAAC,0KAAI;wDACH,MAAM,CAAC,eAAe,EAAE,IAAI,EAAE,EAAE;wDAChC,WAAU;kEACX;;;;;;;;;;;;2CAZI,IAAI,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BnC;GAlHwB;;QAGI,qIAAO;QAGlB,kJAAS;;;KANF","debugId":null}}]
}