{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///c:/rmcontents1/lib/firebase.ts"],"sourcesContent":["// lib/firebase.ts\r\n\r\nimport { initializeApp, getApps, getApp } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getFirestore } from \"firebase/firestore\";\r\nimport { getStorage } from \"firebase/storage\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\r\n};\r\n\r\n// Firebase 앱 초기화 (서버사이드 렌더링 시 중복 초기화 방지)\r\nconst app = !getApps().length ? initializeApp(firebaseConfig) : getApp();\r\n\r\n// 필요한 서비스 내보내기\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\n\r\nexport default app;"],"names":[],"mappings":"AAAA,kBAAkB;;;;;;;;;;;AAQR;AANV;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;;;;;AAEA,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACP;AAEA,yCAAyC;AACzC,MAAM,MAAM,CAAC,IAAA,8KAAO,IAAG,MAAM,GAAG,IAAA,oLAAa,EAAC,kBAAkB,IAAA,6KAAM;AAG/D,MAAM,OAAO,IAAA,wKAAO,EAAC;AACrB,MAAM,KAAK,IAAA,kLAAY,EAAC;AACxB,MAAM,UAAU,IAAA,8KAAU,EAAC;uCAEnB","debugId":null}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///c:/rmcontents1/context/AuthContext.tsx"],"sourcesContent":["// context/AuthContext.tsx\r\n\r\n\"use client\";\r\n\r\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { User, onIdTokenChanged } from \"firebase/auth\";\r\nimport { auth, db } from \"@/lib/firebase\"; // lib/firebase.ts 파일\r\nimport { doc, getDoc } from \"firebase/firestore\";\r\n\r\n// 관리자 권한을 포함한 사용자 정보 인터페이스\r\nexport interface AuthUser extends User {\r\n  isAdmin?: boolean;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: AuthUser | null;\r\n  loading: boolean;\r\n  isFirstLogin: boolean | null; // 첫 로그인 여부 (null: 확인 전)\r\n  checkFirstLogin: (user: User) => Promise<boolean>; // 첫 로그인 체크 함수\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n  user: null,\r\n  loading: true,\r\n  isFirstLogin: null,\r\n  checkFirstLogin: async () => false,\r\n});\r\n\r\n// Context Provider 컴포넌트\r\nexport const AuthProvider = ({ children }: { children: React.ReactNode }) => {\r\n  const [user, setUser] = useState<AuthUser | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isFirstLogin, setIsFirstLogin] = useState<boolean | null>(null);\r\n\r\n  useEffect(() => {\r\n    // 인증 상태 리스너\r\n    const unsubscribe = onIdTokenChanged(auth, async (firebaseUser) => {\r\n      setLoading(true);\r\n      setIsFirstLogin(null); // 유저가 바뀌면 초기화\r\n\r\n      if (firebaseUser) {\r\n        // [관리자 권한 확인]\r\n        // 1단계에서 백엔드(Functions)가 심어준 Custom Claim을 확인합니다.\r\n        const idTokenResult = await firebaseUser.getIdTokenResult();\r\n        const isAdmin = idTokenResult.claims.admin === true;\r\n\r\n        // 관리자 여부를 포함한 AuthUser 객체 생성\r\n        const authUser: AuthUser = {\r\n          ...firebaseUser,\r\n          isAdmin: isAdmin,\r\n        };\r\n        \r\n        setUser(authUser);\r\n        \r\n        // [첫 로그인 여부 확인]\r\n        await checkFirstLogin(firebaseUser);\r\n\r\n      } else {\r\n        setUser(null);\r\n      }\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => unsubscribe(); // 클린업\r\n  }, []);\r\n\r\n  /**\r\n   * Firestore의 'users' 컬렉션을 확인하여 프로필이 존재하는지 체크합니다.\r\n   * @param firebaseUser 인증된 사용자 객체\r\n   * @returns 첫 로그인이면 true, 아니면 false\r\n   */\r\n  const checkFirstLogin = async (firebaseUser: User): Promise<boolean> => {\r\n    const userDocRef = doc(db, \"users\", firebaseUser.uid);\r\n    const docSnap = await getDoc(userDocRef);\r\n    \r\n    const isNew = !docSnap.exists();\r\n    setIsFirstLogin(isNew);\r\n    return isNew;\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    loading,\r\n    isFirstLogin,\r\n    checkFirstLogin,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {!loading && children} {/* 로딩이 끝나면 자식 컴포넌트 렌더링 */}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// Context를 쉽게 사용하기 위한 Custom Hook\r\nexport const useAuth = () => {\r\n  return useContext(AuthContext);\r\n};"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;;AAI1B;AACA;AAAA;AACA,yMAA2C,qBAAqB;AAChE;AAAA;;;AALA;;;;;AAmBA,MAAM,4BAAc,IAAA,8KAAa,EAAkB;IACjD,MAAM;IACN,SAAS;IACT,cAAc;IACd,iBAAiB,UAAY;AAC/B;AAGO,MAAM,eAAe,CAAC,EAAE,QAAQ,EAAiC;;IACtE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAkB;IAClD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAiB;IAEjE,IAAA,0KAAS;kCAAC;YACR,YAAY;YACZ,MAAM,cAAc,IAAA,iLAAgB,EAAC,0HAAI;sDAAE,OAAO;oBAChD,WAAW;oBACX,gBAAgB,OAAO,cAAc;oBAErC,IAAI,cAAc;wBAChB,cAAc;wBACd,iDAAiD;wBACjD,MAAM,gBAAgB,MAAM,aAAa,gBAAgB;wBACzD,MAAM,UAAU,cAAc,MAAM,CAAC,KAAK,KAAK;wBAE/C,6BAA6B;wBAC7B,MAAM,WAAqB;4BACzB,GAAG,YAAY;4BACf,SAAS;wBACX;wBAEA,QAAQ;wBAER,gBAAgB;wBAChB,MAAM,gBAAgB;oBAExB,OAAO;wBACL,QAAQ;oBACV;oBACA,WAAW;gBACb;;YAEA;0CAAO,IAAM;0CAAe,MAAM;QACpC;iCAAG,EAAE;IAEL;;;;GAIC,GACD,MAAM,kBAAkB,OAAO;QAC7B,MAAM,aAAa,IAAA,yKAAG,EAAC,wHAAE,EAAE,SAAS,aAAa,GAAG;QACpD,MAAM,UAAU,MAAM,IAAA,4KAAM,EAAC;QAE7B,MAAM,QAAQ,CAAC,QAAQ,MAAM;QAC7B,gBAAgB;QAChB,OAAO;IACT;IAEA,MAAM,QAAQ;QACZ;QACA;QACA;QACA;IACF;IAEA,qBACE,6LAAC,YAAY,QAAQ;QAAC,OAAO;;YAC1B,CAAC,WAAW;YAAS;;;;;;;AAG5B;GA/Da;KAAA;AAkEN,MAAM,UAAU;;IACrB,OAAO,IAAA,2KAAU,EAAC;AACpB;IAFa","debugId":null}}]
}