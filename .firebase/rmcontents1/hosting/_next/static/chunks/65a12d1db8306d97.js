(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,14677,e=>{"use strict";let t,s="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),r=new Uint8Array(16),l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));e.s(["v4",0,function(e,a,i){if(s&&!a&&!e)return s();var n=e,d=i;let c=(n=n||{}).random??n.rng?.()??function(){if(!t){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(r)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,a){if((d=d||0)<0||d+16>a.length)throw RangeError(`UUID byte range ${d}:${d+15} is out of buffer bounds`);for(let e=0;e<16;++e)a[d+e]=c[e];return a}return function(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}(c)}],14677)},15160,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),l=e.i(22016),a=e.i(97815),i=e.i(76009);e.i(36180);var n=e.i(98925);e.i(61086);var d=e.i(27215),c=e.i(14677);function o(){let{user:e,loading:o}=(0,a.useAuth)(),m=e?.isAdmin,u=(0,r.useRouter)(),x=(0,r.useParams)().requestId,[h,f]=(0,s.useState)(null),[p,b]=(0,s.useState)(!0),[g,y]=(0,s.useState)(""),[j,N]=(0,s.useState)(!1),[v,w]=(0,s.useState)(!1),[U,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{x&&!o&&m&&(async()=>{b(!0);try{let e=(0,n.doc)(i.db,"requests",x),t=await (0,n.getDoc)(e);t.exists()?f({id:t.id,...t.data()}):y("해당 요청을 찾을 수 없습니다.")}catch(e){y("데이터를 불러오는 중 오류가 발생했습니다.")}b(!1)})()},[x,e,o,m]),(0,s.useEffect)(()=>{!o&&(e&&m||u.push("/dashboard"))},[e,o,m,u]);let R=async()=>{N(!0);try{let e=(0,n.doc)(i.db,"requests",x);await (0,n.updateDoc)(e,{status:"in_progress"}),f(e=>e?{...e,status:"in_progress"}:null)}catch(e){y("상태 변경 중 오류 발생")}N(!1)},k=async()=>{if(!U)return void y("완료 파일을 선택해주세요.");w(!0),y("");try{let e=`${(0,c.v4)()}-${U.name}`,t=`completed/${x}/${e}`,s=(0,d.ref)(i.storage,t);await (0,d.uploadBytes)(s,U);let r=await (0,d.getDownloadURL)(s),l=(0,n.doc)(i.db,"requests",x);await (0,n.updateDoc)(l,{status:"completed",completedAt:(0,n.serverTimestamp)(),completedFileUrl:r,completedStoragePath:t}),alert("작업 완료 처리 및 파일 업로드에 성공했습니다."),u.push("/admin")}catch(e){console.error("완료 처리 중 에러:",e),y("업로드 중 오류가 발생했습니다."),w(!1)}};return p||o||!m?(0,t.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:"로딩 중..."}):g?(0,t.jsx)("div",{className:"flex min-h-screen items-center justify-center text-red-500",children:g}):h?(0,t.jsx)("div",{className:"flex min-h-screen flex-col",children:(0,t.jsx)("main",{className:"flex-grow bg-gray-50 py-12",children:(0,t.jsxs)("div",{className:"container mx-auto max-w-3xl px-6",children:[(0,t.jsx)(l.default,{href:"/admin",className:"text-sm text-blue-600 hover:underline",children:"← 목록으로 돌아가기"}),(0,t.jsxs)("div",{className:"mt-4 rounded-lg bg-white p-8 shadow-md",children:[(0,t.jsxs)("div",{className:"border-b pb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:h.title}),(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-sm font-semibold
                  ${"requested"===h.status?"bg-red-100 text-red-700":"in_progress"===h.status?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:h.status})]}),(0,t.jsxs)("p",{className:"mt-2 text-gray-600",children:[h.instructorName," (",h.academy,")"]}),(0,t.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["요청일: ",h.requestedAt.toDate().toLocaleString("ko-KR")]}),(0,t.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"상세 요청 내용"}),(0,t.jsx)("p",{className:"whitespace-pre-wrap rounded-md bg-gray-50 p-4 text-gray-700",children:h.details})]}),h.referenceFileUrl&&(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"첨부된 참고 파일"}),(0,t.jsx)("a",{href:h.referenceFileUrl,target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-block text-blue-600 hover:underline",children:"참고 파일 다운로드"})]})]}),(0,t.jsxs)("div",{className:"mt-8",children:["requested"===h.status&&(0,t.jsxs)("div",{className:"rounded-md bg-yellow-50 p-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-yellow-800",children:"작업 시작"}),(0,t.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"이 요청의 작업을 시작하려면 작업 중으로 상태를 변경하세요."}),(0,t.jsx)("button",{onClick:R,disabled:j,className:"mt-3 rounded-md bg-yellow-500 px-4 py-2 text-sm font-medium text-white hover:bg-yellow-600 disabled:opacity-50",children:j?"변경 중...":"▷ 작업 중으로 변경"})]}),"completed"!==h.status&&(0,t.jsxs)("div",{className:"mt-8 rounded-md border border-gray-200 p-6",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"작업 완료 및 파일 업로드"}),(0,t.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,t.jsx)("input",{type:"file",accept:".pdf",onChange:e=>{e.target.files&&e.target.files[0]&&S(e.target.files[0])},className:"block w-full text-sm text-gray-500   file:mr-4 file:rounded-md file:border-0   file:bg-blue-50 file:px-4 file:py-2   file:text-sm file:font-medium file:text-blue-700   hover:file:bg-blue-100"}),(0,t.jsx)("button",{onClick:k,disabled:v||!U,className:"w-full rounded-md bg-blue-600 px-6 py-3 text-base font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:v?"업로드 중...":"✓ 완료 파일 제출하기"})]})]}),"completed"===h.status&&h.completedFileUrl&&(0,t.jsxs)("div",{className:"rounded-md bg-green-50 p-6 text-center",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-green-800",children:"작업 완료됨"}),(0,t.jsx)("p",{className:"mt-2 text-green-700",children:"이 작업은 완료되어 강사에게 전달되었습니다."}),(0,t.jsx)("a",{href:h.completedFileUrl,target:"_blank",rel:"noopener noreferrer",className:"mt-4 inline-block text-blue-600 hover:underline",children:"업로드된 완료 파일 확인"})]}),g&&(0,t.jsx)("p",{className:"mt-4 text-center text-red-500",children:g})]})]})]})})}):(0,t.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:"요청 정보를 찾을 수 없습니다."})}e.s(["default",()=>o])}]);